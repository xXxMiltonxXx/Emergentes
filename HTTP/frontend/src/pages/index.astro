---
import Layout from '../layouts/Layout.astro';
import SensorData from '../components/SensorData.jsx';

// La URL de la API debe ser accesible desde el servidor de Astro
// Cuando se ejecuta en Docker, se usar치 el nombre del servicio 'api'.
const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:5000/api/data';

let initialData = [];
try {
  const response = await fetch(API_URL);
  if (response.ok) {
    initialData = await response.json();
  } else {
    console.error("Error fetching initial data:", response.statusText);
  }
} catch (error) {
  console.error("Failed to connect to API:", error);
}
---

<Layout title="IoT Dashboard - HTTP RESTful">
	<main>
		<header>
			<h1>
				<span class="icon">游니</span>
				IoT Sensor Dashboard
			</h1>
			<p>Visualizaci칩n de datos de sensores recibidos por HTTP</p>
		</header>

		<SensorData initialData={initialData} apiUrl={API_URL} client:load />

		<footer>
			<p>Comunicaci칩n v칤a API RESTful (Flask) con un frontend Astro.</p>
		</footer>
	</main>
</Layout>